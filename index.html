<script>
const GITHUB_TOKEN = "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";
const REPO = "loadbit6/shared-auth";
const FILE_PATH = "shared-auth.json";
const BRANCH = "main";

const testUser = {
  username: "testing123",
  passwordHash: "testhash",
  cookies: { theme: "light" }
};

async function saveTestUser() {
  const apiURL = `https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`;

  const res = await fetch(apiURL, {
    headers: {
      Authorization: `Bearer ${GITHUB_TOKEN}`,
      Accept: "application/vnd.github.v3+json"
    }
  });

  if (!res.ok) {
    console.error("❌ Failed to read file:", await res.text());
    return;
  }

  const fileData = await res.json();
  const existing = JSON.parse(atob(fileData.content));

  // Add test user
  existing.users = existing.users || {};
  existing.users[testUser.username] = {
    passwordHash: testUser.passwordHash,
    cookies: testUser.cookies
  };

  const updatedContent = btoa(JSON.stringify(existing, null, 2));

  const putRes = await fetch(apiURL, {
    method: "PUT",
    headers: {
      Authorization: `Bearer ${GITHUB_TOKEN}`,
      Accept: "application/vnd.github.v3+json"
    },
    body: JSON.stringify({
      message: "Add test user",
      content: updatedContent,
      sha: fileData.sha,
      branch: BRANCH
    })
  });

  if (!putRes.ok) {
    console.error("❌ Save failed:", await putRes.text());
  } else {
    alert("✅ File saved!");
  }
}

saveTestUser();
</script>
