<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login</title>
</head>
<body>
  <h2>Login</h2>
  <form id="loginForm">
    <input type="text" id="username" placeholder="Username" required>
    <input type="password" id="password" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>
  <div id="status"></div>

  <script>
    const loginForm = document.getElementById("loginForm");
    const statusDiv = document.getElementById("status");

    // Handle login form submission
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      // Check if username and password are filled
      if (!username || !password) {
        statusDiv.textContent = "❌ Please fill in both fields.";
        return;
      }

      statusDiv.textContent = "Checking credentials...";

      try {
        // Send request to backend to fetch login.json
        const response = await fetch("https://shared-auth-backend.onrender.com/data");

        if (!response.ok) {
          statusDiv.textContent = `❌ Could not connect to backend: ${response.statusText}`;
          return;
        }

        const data = await response.json();
        const users = data.users || {};

        if (users[username]) {
          // Compare the password with the hash (simple comparison, you should hash and compare in real use cases)
          const user = users[username];
          const passwordHash = user.passwordHash; // In reality, you'd hash the password and compare

          if (password === passwordHash) {
            statusDiv.textContent = "✅ Login successful!";
            // Handle cookies or any further actions
          } else {
            statusDiv.textContent = "❌ Incorrect password.";
          }
        } else {
          statusDiv.textContent = "❌ User not found.";
        }
      } catch (error) {
        console.error("Error:", error);
        statusDiv.textContent = "❌ Failed to connect to backend.";
      }
    });
  </script>
</body>
</html>
