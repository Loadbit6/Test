<!DOCTYPE html>
<html>
<head>
  <title>Login / Signup</title>
  <style>
    body { font-family: sans-serif; max-width: 400px; margin: auto; padding-top: 50px; }
    input, button { display: block; margin: 10px 0; width: 100%; padding: 8px; }
    #status { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>Login or Signup</h2>

  <input type="text" id="username" placeholder="Username" />
  <input type="password" id="password" placeholder="Password" />

  <button onclick="login()">🔐 Sign In</button>
  <button onclick="signup()">🆕 Sign Up</button>

  <div id="status">Waiting for input...</div>

  <script>
    const backendUrl = "https://shared-auth-backend.onrender.com";

    async function login() {
      updateStatus("Attempting login...");

      const res = await sendRequest("/login");
      if (res.success) updateStatus("✅ Login successful!");
      else updateStatus("❌ " + res.message);
    }

    async function signup() {
      updateStatus("Creating account...");

      const res = await sendRequest("/signup");
      if (res.success) updateStatus("✅ Account created!");
      else updateStatus("❌ " + res.message);
    }

    async function sendRequest(endpoint) {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
      const passwordHash = sha256(password); // Simple hash to match your format

      try {
        const response = await fetch(`${backendUrl}${endpoint}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, passwordHash })
        });
        return await response.json();
      } catch (err) {
        updateStatus("❌ Could not connect to backend");
        return { success: false, message: err.message };
      }
    }

    function updateStatus(msg) {
      document.getElementById("status").innerText = msg;
    }

    // Simple SHA-256 hash using browser crypto API
    function sha256(str) {
      const encoder = new TextEncoder();
      const data = encoder.encode(str);
      return crypto.subtle.digest("SHA-256", data).then(buf => {
        return Array.from(new Uint8Array(buf)).map(x => x.toString(16).padStart(2, '0')).join('');
      });
    }
  </script>
</body>
</html>
