<!DOCTYPE html>
<html>
<head>
  <title>Create or Login</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    .box { max-width: 300px; margin: auto; }
    input, button { width: 100%; margin: 0.5em 0; padding: 0.5em; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Create Account</h2>
    <input type="text" id="newUsername" placeholder="New Username" />
    <input type="password" id="newPassword" placeholder="New Password" />
    <button onclick="createAccount()">Create Account</button>
  </div>

 <script>
const GITHUB_TOKEN = "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"; // keep private
const REPO = "loadbit6/shared-auth";
const FILE_PATH = "shared-auth.json";
const BRANCH = "main";

const newUser = {
  username: "testuser",
  passwordHash: "fakehashedpass123",
  cookies: {
    theme: "light",
    layout: "list"
  }
};

async function updateFileWithNewUser() {
  const apiURL = `https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`;

  const res = await fetch(apiURL, {
    headers: {
      Authorization: `Bearer ${GITHUB_TOKEN}`,
      Accept: "application/vnd.github.v3+json"
    }
  });

  if (!res.ok) {
    console.error("Error fetching file:", await res.text());
    return;
  }

  const fileData = await res.json();
  const content = atob(fileData.content);
  const json = JSON.parse(content);

  // Inject new user into "users"
  json.users = json.users || {};
  json.users[newUser.username] = {
    passwordHash: newUser.passwordHash,
    cookies: newUser.cookies
  };

  const updatedContent = btoa(JSON.stringify(json, null, 2));

  const result = await fetch(apiURL, {
    method: "PUT",
    headers: {
      Authorization: `Bearer ${GITHUB_TOKEN}`,
      Accept: "application/vnd.github.v3+json"
    },
    body: JSON.stringify({
      message: `Add user ${newUser.username}`,
      content: updatedContent,
      sha: fileData.sha,
      branch: BRANCH
    })
  });

  if (!result.ok) {
    console.error("Save failed:", await result.text());
    return;
  }

  alert("âœ… Saved! Check your GitHub repo.");
}

updateFileWithNewUser();
</script>
</body>
</html>
